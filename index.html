<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‡ªå»ºæ°‘å®¿å”ä½œç®¡ç† (Pro)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 110px; /* å¢åŠ åº•éƒ¨ç©ºé–“ */
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .nav-btn { color: #94a3b8; transition: all 0.2s; }
        .nav-btn.active { color: #0f172a; transform: translateY(-2px); }
        .nav-btn.active svg { stroke: #0f172a; stroke-width: 2.5; }

        .timeline-connector {
            position: absolute;
            left: 19px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background: #cbd5e1;
            z-index: 0;
        }
        .timeline-group:last-child .timeline-item:last-child .timeline-connector { display: none; }

        /* Tag Styles */
        .tag-arch { background-color: #e0e7ff; color: #4338ca; border: 1px solid #c7d2fe; }
        .tag-design { background-color: #ffe4e6; color: #e11d48; border: 1px solid #fecdd3; }
        .tag-mgmt { background-color: #f1f5f9; color: #475569; }
        .tag-detail { background-color: #fff7ed; color: #c2410c; }
        
        /* Input Styles */
        .note-input {
            width: 100%;
            font-size: 13px;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
            transition: all 0.2s;
            resize: none; 
            height: 60px;
        }
        .note-input:focus {
            outline: none;
            border-color: #94a3b8;
            background-color: #ffffff;
            box-shadow: 0 0 0 2px rgba(148, 163, 184, 0.1);
        }
        .note-label {
            font-size: 11px;
            font-weight: 700;
            margin-bottom: 4px;
            display: block;
            color: #64748b;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-white sticky top-0 z-40 border-b border-slate-200 shadow-sm">
        <div class="px-5 py-3 flex justify-between items-center">
            <div>
                <h1 class="text-lg font-bold text-slate-800" id="header-title">å”ä½œç®¡ç†ç¸½è¡¨</h1>
                <p class="text-[10px] text-slate-400 font-bold tracking-wider" id="header-subtitle">PRO DASHBOARD</p>
            </div>
            <div class="flex flex-col items-end">
                <span class="text-[10px] text-slate-400 font-bold mb-0.5">ç¸½å®Œæˆåº¦</span>
                <span class="text-sm font-bold text-white bg-slate-800 px-2.5 py-0.5 rounded-full" id="overall-progress">0%</span>
            </div>
        </div>
        
        <!-- Filter Tabs -->
        <div id="filter-container" class="flex px-5 pb-3 gap-2 overflow-x-auto hide-scrollbar">
            <button onclick="setFilter('all')" class="filter-btn active whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-bold text-white bg-slate-800 transition-colors">å…¨éƒ¨</button>
            <button onclick="setFilter('å»ºç¯‰å¸«')" class="filter-btn whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-bold text-slate-500 bg-slate-100 transition-colors">å»ºç¯‰å¸«</button>
            <button onclick="setFilter('è¨­è¨ˆå¸«')" class="filter-btn whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-bold text-slate-500 bg-slate-100 transition-colors">è¨­è¨ˆå¸«</button>
            <button onclick="setFilter('todo')" class="filter-btn whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-bold text-slate-500 bg-slate-100 transition-colors">å¾…è¾¦</button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="px-4 py-4 space-y-4 min-h-screen" id="app-container">
        <!-- Injected via JS -->
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 pb-safe px-2 flex justify-around items-center z-50 h-[80px] shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <button onclick="switchTab('management')" class="nav-btn active flex flex-col items-center justify-center w-24 h-full" id="nav-management">
            <svg class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
            </svg>
            <span class="text-[10px] font-bold">å”ä½œæ¸…å–®</span>
        </button>
        
        <button onclick="switchTab('timeline')" class="nav-btn flex flex-col items-center justify-center w-24 h-full" id="nav-timeline">
            <svg class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="text-[10px] font-bold">å…¨æ™‚ç¨‹è¡¨</span>
        </button>

        <button onclick="switchTab('spaces')" class="nav-btn flex flex-col items-center justify-center w-24 h-full" id="nav-spaces">
            <svg class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
            <span class="text-[10px] font-bold">ç©ºé–“ç¸½è¦½</span>
        </button>
    </nav>

    <script>
        // ================= è³‡æ–™åˆå§‹åŒ– (åŠ å…¥ç­†è¨˜æ¬„ä½) =================
        // æ‰€æœ‰é …ç›®é è¨­æ–°å¢: ownerNote (æ¥­ä¸»ç­†è¨˜), commNote (æºé€šäº‹é …)

        const initialManagement = [
            { id: 101, type: "mgmt", phase: "è¦åŠƒ", name: "å»ºç¯‰é…ç½®èˆ‡å‹•ç·š", role: "å»ºç¯‰å¸«", decision: "æ±ºå®šå»ºç¯‰æ–¹ä½ã€æˆ¿å‹ã€ç¸½åªæ•¸", note: "è¨­è¨ˆå¸«éœ€åƒèˆ‡ç¢ºèªæ¡å…‰èˆ‡éš”é–“é‚è¼¯", status: "todo", ownerNote: "", commNote: "" },
            { id: 102, type: "mgmt", phase: "å®¤å…§", name: "å¼±é›»èˆ‡æ’åº§è¦åŠƒ", role: "è¨­è¨ˆå¸«", decision: "3Cä½¿ç”¨ç¿’æ…£ã€ç‡ˆæ§æ¨¡å¼", note: "éœ€èˆ‡å»ºç¯‰å¸«ç¢ºèªçµæ§‹å‰ªåŠ›ç‰†ä½ç½®", status: "todo", ownerNote: "", commNote: "" },
            { id: 103, type: "mgmt", phase: "è¨­å‚™", name: "ç©ºèª¿èˆ‡é€šé¢¨ç³»çµ±", role: "è¨­è¨ˆå¸«", decision: "å†·æ°£å“ç‰Œã€å†·æˆ¿èƒ½åŠ›ã€é ç®—", note: "åŠéš±å¼å†·æ°£éœ€ç¢ºèªæ¨‘ä¸‹é«˜åº¦èˆ‡æ’æ°´", status: "todo", ownerNote: "", commNote: "" },
            { id: 104, type: "mgmt", phase: "å»ºç¯‰", name: "å»šæˆ¿èˆ‡è¡›æµ´ç®¡ç·š", role: "å»ºç¯‰å¸«", decision: "å»šå…·å½¢å¼(ä¸­å³¶/ä¸€å­—)ã€é¦¬æ¡¶ä½ç½®", note: "æ´©æ°´å¡åº¦èˆ‡ç³ç®¡éœ€åœ¨çŒæ¼¿å‰å®šæ¡ˆ", status: "todo", ownerNote: "", commNote: "" },
            { id: 105, type: "mgmt", phase: "å¤–è§€", name: "æ™¯è§€èˆ‡å¤–ç‰†æè³ª", role: "å»ºç¯‰å¸«", decision: "çŸ³æ/å¡—æ–™é¸æ“‡ã€æ‹›ç‰Œä½ç½®", note: "è¨­è¨ˆå¸«éœ€å”èª¿å¤–ç‰†äº®åŒ–èˆ‡å¤œé–“æ°›åœ", status: "todo", ownerNote: "", commNote: "" },
            { id: 106, type: "mgmt", phase: "åŸ·ç…§", name: "å»ºç…§ç”³è«‹æ›ä»¶", role: "å»ºç¯‰å¸«", decision: "ç¢ºèªæœ€çµ‚å¤–è§€é¡è‰²ã€é–‹çª—", note: "é–‹çª—ä½ç½®å½±éŸ¿å®¤å…§å®¶å…·æ“ºæ”¾", status: "todo", ownerNote: "", commNote: "" },
            { id: 107, type: "mgmt", phase: "åŸ·ç…§", name: "ä½¿ç”¨åŸ·ç…§ç”³è«‹", role: "å»ºç¯‰å¸«", decision: "æ°‘å®¿åˆæ³•åŒ–æŸ¥é©—äº‹é …", note: "ç¢ºä¿å®¤å…§è£ä¿®ä¸å½±éŸ¿æ¶ˆé˜²æ³•è¦", status: "todo", ownerNote: "", commNote: "" },
            { id: 108, type: "mgmt", phase: "è»Ÿè£", name: "å®¶å…·èˆ‡è—è¡“å“", role: "è¨­è¨ˆå¸«", decision: "è»Ÿè£é ç®—ã€é¢¨æ ¼ã€ç•«ä½œ", note: "ç¢ºä¿å·¥åœ°æ¸…æ½”ï¼Œé¿å…ç²‰å¡µæ±™æŸ“", status: "todo", ownerNote: "", commNote: "" },
            // ç´°é …
            { id: 401, type: "detail", phase: "ç„é—œ", name: "å¤§é–€çµæ§‹èˆ‡å‹•ç·šé ç•™", role: "å»ºç¯‰å¸«", decision: "è‡ªå‹•é–€éœ€æ±‚ã€ç„¡éšœç¤™å¡é“", note: "éœ€é…åˆè¨­è¨ˆå¸«çš„é–€ç¦é…ç·šè¦åŠƒ", status: "todo", ownerNote: "", commNote: "" },
            { id: 402, type: "detail", phase: "å®¢å»³", name: "è½åœ°çª—é–‹å£èˆ‡è¦æ ¼", role: "å»ºç¯‰å¸«", decision: "çª—æˆ¶å…’ç«¥å®‰å…¨é–è¦æ ¼", note: "éœ€é…åˆçª—ç°¾ç›’æ·±åº¦é ç•™", status: "todo", ownerNote: "", commNote: "" },
            { id: 403, type: "detail", phase: "å®¢å»³", name: "é›»è¦–ç‰†çµæ§‹è£œå¼·", role: "å»ºç¯‰å¸«", decision: "é›»è¦–å°ºå¯¸é è¨ˆ", note: "éœ€é…åˆå½±éŸ³è¨­å‚™ç®¡ç·šé åŸ‹", status: "todo", ownerNote: "", commNote: "" },
            { id: 404, type: "detail", phase: "å»šæˆ¿", name: "å¼·åˆ¶æ’æ°£å­”èˆ‡ç“¦æ–¯ç®¡", role: "å»ºç¯‰å¸«", decision: "æ˜ç«æˆ–IHçˆ(å½±éŸ¿æ¶ˆé˜²)", note: "éœ€é…åˆè¨­è¨ˆå¸«æ«¥æ«ƒè¨­è¨ˆä½ç½®", status: "todo", ownerNote: "", commNote: "" },
            { id: 405, type: "detail", phase: "å»šæˆ¿", name: "åœ°é¢æ’æ°´å­”å®šä½", role: "å»ºç¯‰å¸«", decision: "ä¸­å³¶æ°´æ§½ä½ç½®ç¢ºèª", note: "éœ€é…åˆä¸­å³¶å°ºå¯¸èˆ‡æ”¶ç´è¦åŠƒ", status: "todo", ownerNote: "", commNote: "" },
            { id: 406, type: "detail", phase: "å®¢æˆ¿", name: "æˆ¿é–“æ·¨å¯¬èˆ‡é¿æŸ±", role: "å»ºç¯‰å¸«", decision: "åºŠå¢Šå°ºå¯¸(åŠ å¤§/å…©å°åºŠ)", note: "éœ€é…åˆåºŠé ­æ«ƒé–‹é—œæ’åº§é…ç½®", status: "todo", ownerNote: "", commNote: "" },
            { id: 407, type: "detail", phase: "å®¢æˆ¿", name: "å†·æ°£æ’æ°´èˆ‡å®¤å¤–æ©Ÿå¹³å°", role: "å»ºç¯‰å¸«", decision: "å†·æ°£ä¸å¯ç›´å¹åºŠé ­", note: "éœ€é…åˆåŠéš±å¼ç¶­ä¿®å­”ä½ç½®", status: "todo", ownerNote: "", commNote: "" },
            { id: 408, type: "detail", phase: "è¡›æµ´", name: "é™æ¿æµ´ç¼¸èˆ‡é˜²æ°´å¡åº¦", role: "å»ºç¯‰å¸«", decision: "æš–é¢¨æ©Ÿéœ€æ±‚(é ç•™æ’æ°£)", note: "éœ€é…åˆä¹¾æ¿•åˆ†é›¢é–€æª»æ–½å·¥", status: "todo", ownerNote: "", commNote: "" },
            { id: 409, type: "detail", phase: "æˆ¶å¤–", name: "è»Šä½åŠƒç·šèˆ‡é€æ°´é‹ªé¢", role: "å»ºç¯‰å¸«", decision: "é è¨ˆè»Šä½æ•¸é‡", note: "éœ€é…åˆé›»å‹•è»Šå……é›»æ¨ç®¡ç·š", status: "todo", ownerNote: "", commNote: "" },
            { id: 501, type: "detail", phase: "ç„é—œ", name: "é‹æ«ƒå®¹é‡èˆ‡é–€ç¦é…ç·š", role: "è¨­è¨ˆå¸«", decision: "æˆ¿å¡èˆ‡æ€¥æ•‘ç®±æ”¶ç´", note: "éœ€é…åˆå»ºç¯‰å¸«å¤§é–€å°ºå¯¸èˆ‡é›»æº", status: "todo", ownerNote: "", commNote: "" },
            { id: 502, type: "detail", phase: "å®¢å»³", name: "çª—ç°¾ç›’èˆ‡è‡¥æ¦»è¨­è¨ˆ", role: "è¨­è¨ˆå¸«", decision: "çª—ç°¾å½¢å¼(è›‡å½¢/æ²ç°¾)", note: "éœ€é…åˆå»ºç¯‰å¸«çª—æ¡†è¦æ ¼", status: "todo", ownerNote: "", commNote: "" },
            { id: 503, type: "detail", phase: "å®¢å»³", name: "å½±éŸ³è¨­å‚™èˆ‡æ•£ç†±è¦åŠƒ", role: "è¨­è¨ˆå¸«", decision: "æŠ•å½±æ©Ÿ/éŸ³éŸ¿ä½ç½®", note: "éœ€ç¢ºèªçµæ§‹è£œå¼·ä½ç½®", status: "todo", ownerNote: "", commNote: "" },
            { id: 504, type: "detail", phase: "å»šæˆ¿", name: "æ«¥æ«ƒè¨­è¨ˆèˆ‡é›»å£“ç¢ºèª", role: "è¨­è¨ˆå¸«", decision: "IHçˆ/æ´—ç¢—æ©Ÿå‹è™Ÿ", note: "éœ€é…åˆå»ºç¯‰å¸«æ’æ°£å­”ä½ç½®", status: "todo", ownerNote: "", commNote: "" },
            { id: 505, type: "detail", phase: "å»šæˆ¿", name: "ä¸­å³¶æ”¶ç´èˆ‡æ°´æ§½è¦åŠƒ", role: "è¨­è¨ˆå¸«", decision: "æ´—ç¢—æ©Ÿ/çƒ¤ç®±ç¨ç«‹é›»æº", note: "éœ€é…åˆå»ºç¯‰å¸«å†·ç†±æ°´ç®¡å®šä½", status: "todo", ownerNote: "", commNote: "" },
            { id: 506, type: "detail", phase: "å®¢æˆ¿", name: "åºŠé ­æ«ƒé–‹é—œèˆ‡é–±è®€ç‡ˆ", role: "è¨­è¨ˆå¸«", decision: "åºŠé ­æ’åº§æ•¸é‡", note: "éœ€é…åˆå»ºç¯‰å¸«æˆ¿é–“å¯¬åº¦é…ç½®", status: "todo", ownerNote: "", commNote: "" },
            { id: 507, type: "detail", phase: "å®¢æˆ¿", name: "åŠéš±å¼ç¶­ä¿®å­”èˆ‡è¿´é¢¨", role: "è¨­è¨ˆå¸«", decision: "å¤©èŠ±æ¿é€ å‹", note: "éœ€é…åˆå»ºç¯‰å¸«å†·æ°£æ’æ°´é«˜åº¦", status: "todo", ownerNote: "", commNote: "" },
            { id: 508, type: "detail", phase: "è¡›æµ´", name: "ä¹¾æ¿•åˆ†é›¢èˆ‡é˜²æ»‘ç£ç£š", role: "è¨­è¨ˆå¸«", decision: "TOTO/HCGå“ç‰Œé¸æ¨£", note: "éœ€é…åˆå»ºç¯‰å¸«æ´©æ°´å¡åº¦", status: "todo", ownerNote: "", commNote: "" },
            { id: 509, type: "detail", phase: "æˆ¶å¤–", name: "åº­åœ’ç‡ˆå…‰èˆ‡å……é›»æ¨", role: "è¨­è¨ˆå¸«", decision: "å¤œé–“ç…§æ˜èˆ‡é˜²èšŠ", note: "éœ€é…åˆå»ºç¯‰å¸«ç®¡ç·šé ç•™", status: "todo", ownerNote: "", commNote: "" }
        ];

        const initialTimeline = [
            { id: 201, stage: "ç¬¬ä¸€éšæ®µï¼šè¨­è¨ˆèˆ‡åŸ·ç…§", months: "M1 - M2", name: "è¦åŠƒèˆ‡è‰åœ–", tasks: "åŸºåœ°æ¸¬é‡ã€å»ºç¯‰è‰åœ–ã€ç‡Ÿé‹ä¼åŠƒæ›¸", status: "todo", ownerNote: "", commNote: "" },
            { id: 202, stage: "ç¬¬ä¸€éšæ®µï¼šè¨­è¨ˆèˆ‡åŸ·ç…§", months: "M3 - M4", name: "å®¤å…§è¨­è¨ˆä»‹å…¥", tasks: "å¹³é¢é…ç½®ã€ç«‹é¢è¨­è¨ˆã€çµæ§‹ç³»çµ±ã€æ©Ÿé›»æ•´åˆ", status: "todo", ownerNote: "", commNote: "" },
            { id: 203, stage: "ç¬¬ä¸€éšæ®µï¼šè¨­è¨ˆèˆ‡åŸ·ç…§", months: "M5 - M6", name: "å®šæ¡ˆèˆ‡åŸ·ç…§", tasks: "å»ºç…§åœ–èªªæ›ä»¶ã€å¤–è§€æè³ªå®šæ¡ˆ (é—œéµé‡Œç¨‹ç¢‘)", status: "todo", ownerNote: "", commNote: "" },
            { id: 204, stage: "ç¬¬äºŒéšæ®µï¼šç™¼åŒ…èˆ‡æ–½å·¥", months: "M7", name: "ç™¼åŒ…èˆ‡æ•´åœ°", tasks: "ç‡Ÿé€ æ¨™å–®ã€å» å•†é´é¸ã€é–‹å·¥æ‹œæ‹œã€åŸºåœ°æ”¾æ¨£", status: "todo", ownerNote: "", commNote: "" },
            { id: 205, stage: "ç¬¬äºŒéšæ®µï¼šç™¼åŒ…èˆ‡æ–½å·¥", months: "M8 - M10", name: "çµæ§‹é«”å·¥ç¨‹", tasks: "åŸºç¤å·¥ç¨‹ã€çµæ§‹é«”æ–½å·¥ã€æ¯å±¤çŒæ¼¿å‰æ°´é›»æŸ¥é©—", status: "todo", ownerNote: "", commNote: "" },
            { id: 206, stage: "ç¬¬äºŒéšæ®µï¼šç™¼åŒ…èˆ‡æ–½å·¥", months: "M11 - M13", name: "å¤–è§€å·¥ç¨‹", tasks: "å¤–ç‰†é˜²æ°´ã€é£¾ææ–½å·¥ã€æ‹†æ¶å‰å¤–è§€ç¸½æª¢", status: "todo", ownerNote: "", commNote: "" },
            { id: 207, stage: "ç¬¬äºŒéšæ®µï¼šç™¼åŒ…èˆ‡æ–½å·¥", months: "M14 - M16", name: "ä½¿ç…§ç”³è«‹", tasks: "è½æ¶æ¸…æ½”ã€ç”³è«‹ä½¿ç…§ã€é–€çª—å®‰è£ã€å®¤å…§æ”¾æ¨£", status: "todo", ownerNote: "", commNote: "" },
            { id: 208, stage: "ç¬¬ä¸‰éšæ®µï¼šè£ä¿®èˆ‡æ™¯è§€", months: "M17 - M19", name: "å®¤å…§è£ä¿®", tasks: "å†·æ°£é…ç®¡ã€æœ¨ä½œã€æ²¹æ¼†ã€åœ°æ¿ã€ç³»çµ±æ«ƒ", status: "todo", ownerNote: "", commNote: "" },
            { id: 209, stage: "ç¬¬ä¸‰éšæ®µï¼šè£ä¿®èˆ‡æ™¯è§€", months: "M20 - M21", name: "æ™¯è§€èˆ‡æ”¶å°¾", tasks: "æ™¯è§€æ¤æ ½ã€æˆ¶å¤–ç‡ˆå…‰ã€è¡›æµ´å®‰è£ã€å»šå…·å®¶é›»", status: "todo", ownerNote: "", commNote: "" },
            { id: 210, stage: "ç¬¬ä¸‰éšæ®µï¼šè£ä¿®èˆ‡æ™¯è§€", months: "M22", name: "è»Ÿè£é€²å ´", tasks: "æ´»å‹•å®¶å…·ã€çª—ç°¾ã€å‚™å“ã€POSèˆ‡é–€ç¦æ¸¬è©¦", status: "todo", ownerNote: "", commNote: "" },
            { id: 211, stage: "ç¬¬å››éšæ®µï¼šåˆæ³•åŒ–ç‡Ÿé‹", months: "M23", name: "åˆæ³•åŒ–ç”³è«‹", tasks: "æ¶ˆé˜²ç«£å·¥æŸ¥é©—ã€ç”³è«‹æ°‘å®¿ç™»è¨˜è­‰ã€ä¿éšª", status: "todo", ownerNote: "", commNote: "" },
            { id: 212, stage: "ç¬¬å››éšæ®µï¼šåˆæ³•åŒ–ç‡Ÿé‹", months: "M24", name: "è©¦ç‡Ÿé‹", tasks: "ç©ºé–“æ”å½±ã€å®˜ç¶²ä¸Šæ¶ã€è©¦ç‡Ÿé‹ã€æµç¨‹èª¿æ•´", status: "todo", ownerNote: "", commNote: "" }
        ];

        // ç©ºé–“ç¸½è¦½ View
        const initialSpaces = [
            { zone: "1. ç„é—œ/å¤§å»³", desc: "é–€é¢èˆ‡æ¥å¾…æ ¸å¿ƒ" },
            { zone: "2. å®¢å»³ (äº¤èª¼å»³)", desc: "å…¬å…±ä¼‘æ†©ç©ºé–“" },
            { zone: "3. é¤å»³/Mini Bar", desc: "ç”¨é¤èˆ‡èŒ¶æ°´æœå‹™" },
            { zone: "4. å»šæˆ¿", desc: "çƒ¹é£ªèˆ‡å¾Œå ´ä½œæ¥­" },
            { zone: "5. å®¢æˆ¿ (ä¸€èˆ¬)", desc: "æ—…å®¢ä¼‘æ†©æ ¸å¿ƒ" },
            { zone: "6. è¡›æµ´ç©ºé–“", desc: "ä¹¾æ¿•åˆ†é›¢èˆ‡è¨­å‚™" },
            { zone: "7. æœå‹™ç©ºé–“", desc: "å‚™å“èˆ‡æ´—æ»Œä½œæ¥­" },
            { zone: "8. æˆ¶å¤–/å…¶ä»–", desc: "åœè»Šèˆ‡åº­åœ’æ´»å‹•" }
        ];

        // ================= App é‚è¼¯ =================

        let activeTab = 'management';
        let currentFilter = 'all';
        let appData = {
            management: JSON.parse(localStorage.getItem('bnb_pro_mgmt')) || initialManagement,
            timeline: JSON.parse(localStorage.getItem('bnb_pro_time')) || initialTimeline,
            spaces: initialSpaces
        };

        function saveData() {
            localStorage.setItem('bnb_pro_mgmt', JSON.stringify(appData.management));
            localStorage.setItem('bnb_pro_time', JSON.stringify(appData.timeline));
            updateOverallProgress();
        }

        // é€šç”¨æ›´æ–°å‡½å¼ï¼šæ›´æ–°ç­†è¨˜èˆ‡æºé€šå…§å®¹
        function updateNote(type, id, field, value) {
            let targetArray = type === 'management' ? appData.management : appData.timeline;
            const item = targetArray.find(i => i.id === id);
            if (item) {
                item[field] = value;
                saveData();
            }
        }

        function switchTab(tabName) {
            activeTab = tabName;
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`nav-${tabName}`).classList.add('active');

            const titleEl = document.getElementById('header-title');
            const subTitleEl = document.getElementById('header-subtitle');
            const filterContainer = document.getElementById('filter-container');
            
            if (tabName === 'management') {
                titleEl.textContent = 'å”ä½œç®¡ç†ç¸½è¡¨';
                subTitleEl.textContent = 'INTEGRATED DASHBOARD';
                filterContainer.classList.remove('hidden');
                filterContainer.classList.add('flex');
                renderManagement();
            } else if (tabName === 'timeline') {
                titleEl.textContent = '24å€‹æœˆå…¨æ™‚ç¨‹è¡¨';
                subTitleEl.textContent = 'FULL PROJECT TIMELINE';
                filterContainer.classList.remove('flex');
                filterContainer.classList.add('hidden');
                renderTimeline();
            } else if (tabName === 'spaces') {
                titleEl.textContent = 'ç©ºé–“ç´°ç¯€ç¸½è¦½';
                subTitleEl.textContent = 'SPACE OVERVIEW';
                filterContainer.classList.remove('flex');
                filterContainer.classList.add('hidden');
                renderSpaces();
            }
            window.scrollTo(0, 0);
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                const btnText = btn.innerText;
                const filterMap = {'all': 'å…¨éƒ¨', 'å»ºç¯‰å¸«': 'å»ºç¯‰å¸«', 'è¨­è¨ˆå¸«': 'è¨­è¨ˆå¸«', 'todo': 'å¾…è¾¦'};
                if(btnText === filterMap[filter]) {
                    btn.classList.add('active', 'bg-slate-800', 'text-white');
                    btn.classList.remove('bg-slate-100', 'text-slate-500');
                } else {
                    btn.classList.remove('active', 'bg-slate-800', 'text-white');
                    btn.classList.add('bg-slate-100', 'text-slate-500');
                }
            });
            renderManagement();
        }

        // ================= æ¸²æŸ“åŠŸèƒ½ =================

        function renderManagement() {
            const container = document.getElementById('app-container');
            container.innerHTML = '';
            
            const filteredData = appData.management.filter(item => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'todo') return item.status === 'todo';
                return item.role === currentFilter;
            });

            if (filteredData.length === 0) {
                container.innerHTML = `<div class="text-center py-12 text-slate-400 text-sm">æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„é …ç›®</div>`;
                return;
            }

            filteredData.forEach(item => {
                const isDone = item.status === 'done';
                const isDetail = item.type === 'detail';
                const typeTag = isDetail ? `<span class="text-[10px] font-bold uppercase px-1.5 py-0.5 rounded tag-detail">åŸ·è¡Œç´°é …</span>` 
                                         : `<span class="text-[10px] font-bold uppercase px-1.5 py-0.5 rounded tag-mgmt">å°ˆæ¡ˆç®¡ç†</span>`;
                const roleClass = item.role === 'å»ºç¯‰å¸«' ? 'tag-arch' : 'tag-design';
                
                const html = `
                <div class="bg-white rounded-xl p-4 card-shadow border border-slate-100 mb-4 ${isDone ? 'opacity-80' : ''}">
                    <!-- Header -->
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex items-center gap-2">
                            ${typeTag}
                            <span class="text-[10px] font-bold text-slate-500 bg-slate-100 px-2 py-0.5 rounded uppercase">${item.phase}</span>
                        </div>
                        <span class="text-[10px] font-bold px-2 py-0.5 rounded ${roleClass}">${item.role}</span>
                    </div>
                    
                    <!-- Title -->
                    <div class="flex items-start gap-3 mb-3">
                        <div onclick="toggleStatus('management', ${item.id})" class="mt-0.5 w-6 h-6 rounded-full border-2 cursor-pointer flex items-center justify-center flex-shrink-0 transition-colors ${isDone ? 'bg-emerald-500 border-emerald-500' : 'border-slate-300'}">
                            ${isDone ? '<svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>' : ''}
                        </div>
                        <h3 class="text-base font-bold text-slate-800 leading-snug ${isDone ? 'line-through text-slate-400' : ''}">${item.name}</h3>
                    </div>

                    <!-- Details Box -->
                    <div class="space-y-2 pl-9 mb-4">
                        <div class="bg-slate-50 p-2.5 rounded-lg border border-slate-100">
                            <p class="text-[10px] text-slate-400 font-bold mb-0.5">æ±ºç­–é‡é»</p>
                            <p class="text-xs text-slate-700 font-medium leading-relaxed">${item.decision}</p>
                        </div>
                        <div class="relative pl-2.5 border-l-2 border-amber-200">
                            <p class="text-[10px] text-slate-400 font-bold mb-0.5">å”ä½œæé†’</p>
                            <p class="text-xs text-slate-500 italic leading-relaxed">${item.note}</p>
                        </div>
                    </div>

                    <!-- Input Fields -->
                    <div class="pl-9 grid grid-cols-1 gap-3">
                        <div>
                            <label class="note-label text-blue-600">ğŸ“ æ¥­ä¸»ç­†è¨˜ (ç§äººå‚™å¿˜)</label>
                            <textarea class="note-input" placeholder="è¼¸å…¥é ç®—ã€æƒ³æ³•ç­†è¨˜..." oninput="updateNote('management', ${item.id}, 'ownerNote', this.value)">${item.ownerNote || ''}</textarea>
                        </div>
                        <div>
                            <label class="note-label text-rose-600">ğŸ’¬ èˆ‡å»ºç¯‰å¸«/è¨­è¨ˆå¸«æºé€šäº‹é …</label>
                            <textarea class="note-input" placeholder="è¼¸å…¥å¾…ç¢ºèªäº‹é …ã€æœƒè­°çµè«–..." oninput="updateNote('management', ${item.id}, 'commNote', this.value)">${item.commNote || ''}</textarea>
                        </div>
                    </div>
                </div>`;
                container.innerHTML += html;
            });
        }

        function renderTimeline() {
            const container = document.getElementById('app-container');
            container.innerHTML = '';
            
            const stages = {};
            appData.timeline.forEach(item => {
                if (!stages[item.stage]) stages[item.stage] = [];
                stages[item.stage].push(item);
            });

            Object.keys(stages).forEach(stageName => {
                container.innerHTML += `
                    <div class="sticky top-[110px] bg-f1f5f9/95 backdrop-blur z-30 py-2 mb-2">
                        <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest pl-2 border-l-4 border-slate-800">${stageName}</h2>
                    </div>
                    <div class="timeline-group relative mb-6">`;
                
                stages[stageName].forEach(item => {
                    const isDone = item.status === 'done';
                    const monthText = item.months.split('-')[0].replace('M','M\n'); 
                    
                    const html = `
                    <div class="relative pl-10 timeline-item pb-8">
                        <div class="timeline-connector"></div>
                        <div onclick="toggleStatus('timeline', ${item.id})" class="absolute left-2 top-0 w-8 h-8 rounded-full border-2 bg-white z-10 flex items-center justify-center cursor-pointer transition-colors shadow-sm ${isDone ? 'border-emerald-500 bg-emerald-50' : 'border-slate-300'}">
                            ${isDone ? '<div class="w-3 h-3 bg-emerald-500 rounded-full"></div>' : '<span class="text-[9px] text-slate-400 font-bold text-center leading-none mt-0.5">'+monthText+'</span>'}
                        </div>
                        <div class="bg-white rounded-xl p-4 card-shadow border border-slate-100 ${isDone ? 'opacity-80' : ''}">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="text-sm font-bold text-slate-800">${item.name}</h3>
                                <span class="text-[10px] font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded whitespace-nowrap">${item.months}</span>
                            </div>
                            <p class="text-xs text-slate-600 leading-relaxed border-t border-slate-50 pt-2 mt-1 mb-3">${item.tasks}</p>
                            
                            <!-- Input Fields for Timeline -->
                            <div class="grid grid-cols-1 gap-3 pt-2 border-t border-slate-50">
                                <div>
                                    <label class="note-label text-blue-600">ğŸ“ æ¥­ä¸»ç­†è¨˜</label>
                                    <textarea class="note-input" placeholder="å‚™å¿˜..." oninput="updateNote('timeline', ${item.id}, 'ownerNote', this.value)">${item.ownerNote || ''}</textarea>
                                </div>
                                <div>
                                    <label class="note-label text-rose-600">ğŸ’¬ æºé€šäº‹é …</label>
                                    <textarea class="note-input" placeholder="å¾…ç¢ºèª..." oninput="updateNote('timeline', ${item.id}, 'commNote', this.value)">${item.commNote || ''}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>`;
                    container.innerHTML += html;
                });
                container.innerHTML += `</div>`;
            });
        }

        function renderSpaces() {
            const container = document.getElementById('app-container');
            container.innerHTML = `<div class="bg-blue-50 text-blue-800 p-4 rounded-xl text-xs mb-4">æç¤ºï¼šæ‰€æœ‰ç©ºé–“çš„è©³ç´°åŸ·è¡Œé …ç›®ï¼Œå·²æ•´åˆè‡³ã€Œå”ä½œæ¸…å–®ã€é é¢ï¼Œè«‹åˆ‡æ›è‡³è©²é é¢é€²è¡Œå‹¾é¸èˆ‡ç­†è¨˜è¨˜éŒ„ã€‚</div>`;
            
            appData.spaces.forEach((zone, index) => {
                const itemsInMgmt = appData.management.filter(m => m.type === 'detail' && m.phase.includes(zone.zone.split(' ')[1]));
                const total = itemsInMgmt.length;
                const done = itemsInMgmt.filter(m => m.status === 'done').length;
                
                const html = `
                <div class="bg-white rounded-xl p-4 card-shadow border border-slate-100 mb-4 flex justify-between items-center" onclick="filterByZone('${zone.zone.split(' ')[1]}')">
                    <div>
                        <h3 class="text-sm font-bold text-slate-800">${zone.zone}</h3>
                        <p class="text-xs text-slate-500 mt-1">${zone.desc}</p>
                    </div>
                    <div class="text-right">
                        <span class="text-[10px] font-bold bg-slate-100 text-slate-600 px-2 py-1 rounded-full">${done}/${total} é …å®Œæˆ</span>
                        <div class="text-[10px] text-indigo-500 mt-2 font-bold cursor-pointer">å‰å¾€ç·¨è¼¯ç´°ç¯€ &rarr;</div>
                    </div>
                </div>`;
                container.innerHTML += html;
            });
        }

        // ================= è¼”åŠ©åŠŸèƒ½ =================

        function toggleStatus(type, id) {
            let targetArray = type === 'management' ? appData.management : appData.timeline;
            const item = targetArray.find(i => i.id === id);
            if (item) {
                item.status = item.status === 'todo' ? 'done' : 'todo';
                saveData();
                if (type === 'management') renderManagement();
                if (type === 'timeline') renderTimeline();
            }
        }

        function filterByZone(zoneName) {
            switchTab('management');
            alert(`è«‹åœ¨æ¸…å–®ä¸­æŸ¥çœ‹ [${zoneName}] ç›¸é—œç´°é …ï¼Œä¸¦ä½¿ç”¨æ–°å¢çš„ç­†è¨˜æ¬„ä½é€²è¡Œè¨˜éŒ„ã€‚`);
        }

        function updateOverallProgress() {
            let total = appData.management.length;
            let done = appData.management.filter(i => i.status === 'done').length;
            let percent = total === 0 ? 0 : Math.round((done / total) * 100);
            const badge = document.getElementById('overall-progress');
            badge.textContent = `${percent}%`;
            badge.className = `text-sm font-bold text-white px-2.5 py-0.5 rounded-full ${percent === 100 ? 'bg-emerald-500' : 'bg-slate-800'}`;
        }

        // åˆå§‹åŒ–
        updateOverallProgress();
        switchTab('management');

    </script>
</body>
</html>